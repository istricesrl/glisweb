{% import '_bin/_form.html' as frm %}

{# DEFINIZIONI #}
{% set table = 'attivita' %}
{% set ietf = localization.language.ietf %}

{# ACCOUNT #}
{% if session.account %}
    {% set account = session.account.id %}
    {% set anagrafica = session.account.id_anagrafica %}
{% else %}
    {% set account = '__null__' %}
    {% set anagrafica = '__null__' %}
{% endif %}

{% if request.table.id %}
{% set method = 'update' %}
{% set activity = 'aggiornamento' %}
{% else %}
{% set method = 'post' %}
{% set activity = 'inserimento' %}
{% endif %}
<script>
    function genera( t ) {

		var marchio = $( '#{{ table }}_id_marchio' ).val();
		var produttore = $( '#{{ table }}_id_produttore' ).val();
		var serial = $( '#{{ table }}_serial_number' ).val();
		var nome = $( '#{{ table }}_nome' ).val();
		var testo = $( '#{{ table }}_testo' ).val();
		var bar = $( '#{{ table }}_barcode' ).val();
		var id_riga = $( '#id_riga' ).val();


    }
</script>

<div class="modal" tabindex="-1" role="dialog" id="carico_ore">
    <div class="modal-dialog modal-lg" role="document">
	<div class="modal-content">
	    <div class="modal-header">
		<h3 class="modal-title">attività</h3>
		<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
	    </div>
	    <div class="modal-body">
		<div class="container-fluid">
			<form id="form-{{ table }}" class="form-main d-flex flex-column flex-fill" action="{{ page.path[ ietf ] }}" method="post" autocomplete="off">

				{# CAMPI HIDDEN DI BASE #}
				<input type="hidden" id="method" name="{{ table }}[__method__]" value="{{ method }}">
				<input type="hidden" id="reset" name="{{ table }}[__reset__]" value="">
				<input type="hidden" id="id_todo" name="{{ table }}[id]" >
                <input type="hidden" id="id_account_inserimento" name="{{ table }}[id_account_inserimento]" value="{{ account }}">
				<input type="hidden" id="id_anagrafica" name="{{ table }}[id_anagrafica]" value="{{ anagrafica }}">	
				<input type="hidden" id="id_mastro" name="{{ table }}[id_mastro_destinazione]" value="{{ etc.mastro_attivita }}">	
                <input type="hidden" id="id_documenti_articoli" name="{{ table }}[id_documenti_articoli]" >	

		    <div class="form-group mt-0">
                <legend>riepilogo todo</legend>
                <div class="row">
                    <div class="col-2"><b>cliente:</b></div> 
                    <div class="col">{{ etc.attivita_todo[0].cliente }}</div>
                </div>
                <div class="row">
                    <div class="col-2"><b>progetto:</b></div> 
                    <div class="col">{{ etc.attivita_todo[0].progetto }}</div>
                </div>
                <div class="row">
                    <div class="col-2"><b>todo:</b></div> 
                    <div class="col">{{ etc.attivita_todo[0].todo }}</div>
                </div>
                <div class="row">
                    <div class="col-2"><b>attività svolte:</b></div>
                    <div class="col">
                        <ul style="padding-left: 15px;" class="mt-0">
                        {% set tot = 0 %}
                        {% for a in etc.attivita_todo %}
                        <li>{{ a.data_attivita|date('d/m/Y') }} - {{ a.nome }}: {{ a.ore }} ore</li>
                        {% set tot = tot + a.ore %}
                        {% endfor %}
                    </ul></div>
                </div>
            </div>
                <legend>stato mastri cliente</legend>

                <legend>attribuzione</legend>
                <div class="form-group form-row">
                    <div class="col-2">
                        <span class="label-top">ore</span>
                        {{ frm.input( table, '', '', ore, '', '', request, tot ) }}
                    </div>
                    <div class="col">
                        <span class="label-top">mastro</span>
                        {{ frm.select( table, '', '', mastro, '', etc.select.mastri_ore, request ) }}
                    </div>
                </div>
                </div>
        
	    <div class="modal-footer">
		<!--button id="annulla_matricola" type="button" class="btn btn-secondary btn-sm" data-dismiss="modal">annulla</button-->
        <button id="elimina_articolo" type="button" class="btn btn-secondary btn-sm" data-dismiss="modal" onclick="window.open('{{ pages.delete.path[ localization.language.ietf ] }}?__delete__[table]=documenti_articoli&__delete__[id]={{ etc.id_riga }}&__delete__[target]={{ page.path[ localization.language.ietf ]|url_encode }}','_self');">elimina articolo</button>
        <button type="submit" class="btn btn-secondary btn-sm" id="genera-btn" >crea</button>
	    </div>
		</div></form>
	</div>
    </div>
</div>
