{% import '_bin/_default.html' as cms %}
{% import '_bin/_form.html' as frm %}
{% import 'bin/default.html' as def %}
{% import 'bin/ritiro.hardware.sub.html' as sub %}

{% extends 'ext/blank.html' %}

{# DEFINIZIONI #}
{% set table = form.table %}
{% set ietf = localization.language.ietf %}

{# ACCOUNT #}
{% if session.account.id %}
    {% set account = session.account.id %}
{% else %}
    {% set account = '__null__' %}
{% endif %}

{% block header %}
<div class="text-left">
        {% set target = pages.casse.url[ ietf ] %}
        <button type="button" class="btn btn-secondary btn-sqr btn-sm" onclick="window.open( '{{ target }}', '_self' );" data-toggle="tooltip" data-placement="bottom" data-delay="1000" title="torna alla dashboard"><i class="fa fa-arrow-circle-o-left" aria-hidden="true"></i></button>
</div>
<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script>
function collapse(a){
	console.log(a);
	if ($("#div-"+a).is(":visible")){
		$('#div-'+a).hide();
		$('#collaps-'+a).html('<i class="fa fa-angle-down" aria-hidden="true"></i>');
	} else {
		$('#div-'+a).show();
		$('#collaps-'+a).html('<i class="fa fa-angle-up" aria-hidden="true"></i>');
	}
}

</script>
{% endblock %}
{% block line %}
{% if session.contatto  %}
<div class="row d-flex align-items-center" style="color: white; background-color: #343A40; padding: 5px;padding-right: 15px;padding-left: 15px;">
    <div class="col"><h3>{{ session.contatto.nome }}</h3></div>
    <div class="col-auto text-right" ><button class="btn btn-light" onclick='window.open("{{ pages.contatti.url[ localization.language.ietf ] }}?__unset__", "_self")'>inserisci nuovo</button> </div>
</div>
{% endif %}
{% endblock %}
{% block main %}


{% set
    trans_day_hash = {
        "Monday": "lunedì", 
        "Tuesday": "martedì", 
        "Wednesday": "mercoledì", 
        "Thursday": "giovedì", 
        "Friday": "venerdì", 
        "Saturday": "sabato", 
        "Sunday": "domenica" 
    }
%}

{% set
    trans_month_hash = {
        "01": "gennaio",
        "02": "febbraio",
        "03": "marzo",
        "04": "aprile",
        "05": "maggio",
        "06": "giugno",
        "07": "luglio",
        "08": "agosto",
        "09": "settembre",
        "10": "ottobre",
        "11": "novembre",
        "12": "dicembre"
    }
%}
<div class="row">
	<div class="col-12" style="background-color: #777777; color: white;">
		<legend class="d-flex justify-content-between"><span>soluzioni</span><span id="collaps-soluzioni" onclick="collapse('soluzioni')">{% if etc.agenda_soluzioni|length <= 0 %} <i class="fa fa-angle-down" aria-hidden="true"></i>{% else  %}<i class="fa fa-angle-up" aria-hidden="true"></i>{% endif %}</span></legend>
	</div>
</div>
<div id="div-soluzioni" {% if etc.agenda_soluzioni|length <= 0 %} hidden{% endif %}>

{% for data,eventi_per_data in etc.agenda_soluzioni %}

<fieldset class="static-history">
<legend>{{ trans_day_hash[data|date('l', "Europe/Rome")] }} {{ data|date('d') }} {{ trans_month_hash[data|date('m')] }} {{ data|date('Y') }}</legend>

    {% for ora,eventi_per_ora in eventi_per_data %}
    {% for e in eventi_per_ora %}
    <div class="form-row agenda-row">
	<div class="col-1 lemma text-right">
	    <p>{% if ora != ora_old %}{{ ora|date(' H:i') }}{% else %}&mdash;{% endif %}</p>
	</div>
	<div class="col">
	    <div class="form-row">
		<div class="col">
		    <p>{{ e.tipologia }} &mdash; {{ e.anagrafica }} <i class="fa fa-comments-o" aria-hidden="true"></i> {{ e.mandante }} {{ e.referente }} </p>
		    {% if e.id_cliente %}<p>cliente: <a href="{{ pages["anagrafica.form"].url[ localization.language.ietf ] }}?anagrafica[id]={{ e.id_cliente }}" target="_blank" > {{ e.cliente }}</a></p>{% endif %}
			{% if e.id_todo %}<p>todo: <a href="{{ pages["todo.form"].url[ localization.language.ietf ] }}?todo[id]={{ e.id_todo }}" target="_blank" > {{ e.todo }}</a></p>{% endif %}
			<p>{{ e.nome }}</p>
		    <p>{{ e.testo }}</p>
		</div>

		<div class="col-auto metro">
		    <a onclick="window.open('{{ pages[ "attivita.form" ].url[ localization.language.ietf ] }}?attivita[id]={{ e.id }}&__backurl__={{ page.backurl[ localization.language.ietf ] }}','_self');">
			<div class="media">
			    <div class="media-body">
				<h5 class="media-text">modifica / concludi attività</h5>
			    </div>
			</div>
		    </a>
		</div>


	    </div>
	</div>
    </div>
    {% set ora_old = ora %}
    {% endfor %}
    {% endfor %}

</fieldset>
{% endfor %}
</div>
<div class="row">
	<div class="col-12" style="background-color: #777777; color: white;">
		<legend class="d-flex justify-content-between"><span>collaudo</span><span id="collaps-collaudo" onclick="collapse('collaudo')">{% if etc.agenda_collaudo|length <= 0 %} <i class="fa fa-angle-down" aria-hidden="true"></i>{% else  %}<i class="fa fa-angle-up" aria-hidden="true"></i>{% endif %}</span></legend>
	</div>
</div>
<div id="div-collaudo" {% if etc.agenda_collaudo|length <= 0 %} hidden{% endif %}>
{% for data,eventi_per_data in etc.agenda_collaudo %}

<fieldset class="static-history">
<legend>{{ trans_day_hash[data|date('l', "Europe/Rome")] }} {{ data|date('d') }} {{ trans_month_hash[data|date('m')] }} {{ data|date('Y') }}</legend>

    {% for ora,eventi_per_ora in eventi_per_data %}
    {% for e in eventi_per_ora %}
    <div class="form-row agenda-row">
	<div class="col-1 lemma text-right">
	    <p>{% if ora != ora_old %}{{ ora|date(' H:i') }}{% else %}&mdash;{% endif %}</p>
	</div>
	<div class="col">
	    <div class="form-row">
		<div class="col">
		    <p>{{ e.tipologia }} &mdash; {{ e.anagrafica }} <i class="fa fa-comments-o" aria-hidden="true"></i> {{ e.mandante }} {{ e.referente }} </p>
			{% if e.id_cliente %}<p>cliente: <a href="{{ pages["anagrafica.form"].url[ localization.language.ietf ] }}?anagrafica[id]={{ e.id_cliente }}" target="_blank" > {{ e.cliente }}</a></p>{% endif %}
			{% if e.id_todo %}<p>todo: <a href="{{ pages["todo.form"].url[ localization.language.ietf ] }}?todo[id]={{ e.id_todo }}" target="_blank" > {{ e.todo }}</a></p>{% endif %}
			<p>{{ e.nome }}</p>
		    <p>{{ e.testo }}</p>
		</div>

		<div class="col-auto metro">
			<a onclick="window.open('{{ pages[ "attivita.form" ].url[ localization.language.ietf ] }}?attivita[id]={{ e.id }}&__backurl__={{ page.backurl[ localization.language.ietf ] }}','_self');">
				<div class="media">
			    <div class="media-body">
				<h5 class="media-text">modifica / concludi attività</h5>
			    </div>
			</div>
		    </a>
		</div>


	    </div>
	</div>
    </div>
    {% set ora_old = ora %}
    {% endfor %}
    {% endfor %}

</fieldset>
{% endfor %}
</div>
<div class="row">
	<div class="col-12" style="background-color: #777777; color: white;">
		<legend class="d-flex justify-content-between"><span>customer care</span><span id="collaps-feed" onclick="collapse('feed')">{% if etc.agenda_feedback|length <= 0 %} <i class="fa fa-angle-down" aria-hidden="true"></i>{% else  %}<i class="fa fa-angle-up" aria-hidden="true"></i>{% endif %}</span></legend>
	</div>
</div>
<div id="div-feed" {% if etc.agenda_feedback|length <= 0 %} hidden{% endif %}>
{% for data,eventi_per_data in etc.agenda_feedback %}

<fieldset class="static-history">
<legend>{{ trans_day_hash[data|date('l', "Europe/Rome")] }} {{ data|date('d') }} {{ trans_month_hash[data|date('m')] }} {{ data|date('Y') }}</legend>

    {% for ora,eventi_per_ora in eventi_per_data %}
    {% for e in eventi_per_ora %}
    <div class="form-row agenda-row">
	<div class="col-1 lemma text-right">
	    <p>{% if ora != ora_old %}{{ ora|date(' H:i') }}{% else %}&mdash;{% endif %}</p>
	</div>
	<div class="col">
	    <div class="form-row">
		<div class="col">
		    <p>{{ e.tipologia }} &mdash; {{ e.anagrafica }} <i class="fa fa-comments-o" aria-hidden="true"></i> {{ e.mandante }} {{ e.referente }} </p>
			{% if e.id_cliente %}<p>cliente: <a href="{{ pages["anagrafica.form"].url[ localization.language.ietf ] }}?anagrafica[id]={{ e.id_cliente }}" target="_blank" > {{ e.cliente }}</a></p>{% endif %}
			{% if e.id_todo %}<p>todo: <a href="{{ pages["todo.form"].url[ localization.language.ietf ] }}?todo[id]={{ e.id_todo }}" target="_blank" > {{ e.todo }}</a></p>{% endif %}
			<p>{{ e.nome }}</p>
		    <p>{{ e.testo }}</p>
		</div>

		<div class="col-auto metro">
			<a onclick="window.open('{{ pages[ "attivita.form" ].url[ localization.language.ietf ] }}?attivita[id]={{ e.id }}&__backurl__={{ page.backurl[ localization.language.ietf ] }}','_self');">
				<div class="media">
			    <div class="media-body">
				<h5 class="media-text">modifica / concludi attività</h5>
			    </div>
			</div>
		    </a>
		</div>


	    </div>
	</div>
    </div>
    {% set ora_old = ora %}
    {% endfor %}
    {% endfor %}

</fieldset>
{% endfor %}
</div>
{% endblock %}