{% import '_bin/_default.html' as cms %}

{% extends 'ext/main.html' %}

{% import '_bin/_form.html' as frm %}
{% import 'bin/default.html' as def %}

{# DEFINIZIONI #}
{% set table = form.table %}
{% set ietf = localization.language.ietf %}

{# ACCOUNT #}
{% if session.account.id %}
    {% set account = session.account.id %}
{% else %}
    {% set account = '__null__' %}
{% endif %}

{# TIPO DI METODO E ATTIVITA' SVOLTA #}
{% if request[ table ].id %}
    {% set method = 'update' %}
    {% set activity = 'aggiornamento' %}
    {% set legend = 'aggiornato ' ~ request[ table ][ 'timestamp_aggiornamento' ]|date('Y/m/d H:i:s') %}
{% else %}
    {% set method = 'post' %}
    {% set activity = 'inserimento' %}
    {% set legend = 'inserimento nuovo oggetto' %}
{% endif %}

{% block main %}
<form  {% if session.contatto %}style="margin-top: 45px;"{% endif %} id="form-{{ table }}" class="{% if session.contatto  %}mt-5{% endif %}form-main d-flex flex-column flex-fill" action="{{ page.path[ ietf ] }}" method="post" autocomplete="off">

    {# CAMPI HIDDEN DI BASE #}
    <input type="hidden" id="id" name="{{ table }}[id]" value="{{ request[ table ].id }}">
    <input type="hidden" id="method" name="{{ table }}[__method__]" value="{{ method }}">
    <input type="hidden" id="reset" name="{{ table }}[__reset__]" value="">
    <input type="hidden" id="id_emittente" name="{{ table }}[id_emittente]" value="{{ etc.id_emittente }}">
    <input type="hidden" id="data" name="{{ table }}[data]" value="{{ 'now'|date('Y-m-d') }}">
    <input type="hidden" id="numero" name="{{ table }}[numero]" value="{{ 'now'|date('U') }}">
    <input type="hidden" id="timestamp" name="{{ table }}[timestamp_{{ activity }}]" value="{{ 'now'|date('U') }}">
    <input type="hidden" id="account" name="{{ table }}[id_account_{{ activity }}]" value="{{ account }}">
    {% if not request[table].id %}
    <input type="hidden" id="tipologia" name="{{ table }}[id_tipologia]" value="{{ etc.default_tipologia }}">
    {% endif %}

    {% if request.__backurl__ %}{# TODO VEDERE SE FUNZIONA ANCHE COSÃŒ FUORI DALL'IF #}{% endif %}
    <input type="hidden" id="backurl" name="__backurl__" value="{{ request.__backurl__ }}">

    {% if  request.documenti.id  %}

    <div class="container-fluid pannello-cassa form-row">

        <div class="col-6 align-items-center"  >
            <legend>prodotti disponibili</legend>
            <div class="form-row">
                <div class="col">
                    <input type="text" class="form-control form-control-sm" name="__view__[{{ view.id }}][__search__]" value="{{ request.__view__[ view.id ].__search__ }}" onchange="$('#pager').val('0');" autofocus>
                </div>
                <div class="col-auto">
                    <button type="submit" class="btn btn-secondary btn-sqr btn-sm"><i class="fa fa-search"></i></button>
                </div>
            </div>
            <div class="box" style="height: 85vh;" >
                {% for row in view.data %}
                <div class="media">
                   
                    <div class="media-body p-3 col-10">
                      <h3 class="mt-0">{{ row.prodotto }}</h3>
                    </div>
                    <div class="col-2 align-middle">
                        <button class="btn"><i class="fa fa-cart-plus fa-3x" aria-hidden="true"></i></button>
                    </div>
                  </div>
                  {% endfor %}
            </div>
        </div>
        <div class="col-6 align-items-center"  >
            <legend>il tuo ordine</legend>
            <div class="box" style="height: 85vh;" >
                {% for p in etc.righe %}
                <a href="{{ cassa }}?__art__={{ articolo.id }}">
                <div class="media">
                   
                    <div class="media-body p-3">
                      <h3 class="mt-0">{{ p.__label__ }}</h3>
                    </div>
                  </div>
                  </a>
                  {% endfor %}
            </div>
        </div>
    </div>
    </div>
    {% else %}
    <div class="col-12 mt-3 cassa" >
        <button type="sumbit" class="btn btn-secondary btn-sqr btn-block" data-toggle="tooltip" data-placement="bottom" data-delay="1000" title="torna alla dashboard">apri nuovo ordine</button>
    </div>

    {% endif %}

</form>
{% endblock %}

