{# MACRO PER LA RAPPRESENTAZIONE DEI CONTENUTI #}
{# NOTA: IMPORTARE SEMPRE COME PRV #}
{# import '_bin/_privacy.html' as prv #}

{# TODO per semplificare, ogni modulo (che sia sotto contatti, registrazione, ecommerce, ecc. poco importa) dovrebbe avere una sua sotto chiave consensi
    contenente tutti i consensi da prestare (termini di servizio, condizioni di vendita, privacy, eccetera) e la macro checkConsensi() dovrebbe semplicemente
    fare il ciclo e creare le checkbox con le label relative e i link se presenti; in questo modo si semplificherebbe molto la gestione a livello di
    config.json perché adesso la roba è troppo sparsa in giro 

    bisognerebbe formalizzare che ogni chiave di modulo (ecommerce, contatti, registrazione, ecc.) abbia una sottochiave moduli con i vari moduli previsit
    per il sito corrente, e ogni modulo abbia una sottochiave consensi con i vari consensi da prestare, e la macro checkConsensi() dovrebbe fare il ciclo
    su questi #}

{% macro checkConsensi( ref, key, items, ietf, tr, pages, session, class, rclass ) %}
{# NOTA items può sembrare ridondante rispetto a items[ key ] ma ci sono form (ad es. __carrello__) che non hanno i due livelli come __contatti__[key] #}
<!-- macro {{ _self }}::checkConsensi() -->
{% if not class %}{% set class = 'col-12 col-md-10 offset-md-2' %}{% endif %}
{% if not rclass %}{% set rclass = 'form-group form-row' %}{% endif %}
{% if items.consensi is iterable %}
{% for codice,check in items.consensi|sort((a, b) => a.ordine <=> b.ordine) %}
{% if key %}{% set nm = '['~ref~']['~key~']['~codice~']' %}{% set id = ref~key~codice %}{% else %}{% set nm = '['~ref~']['~codice~']' %}{% set id = ref~codice %}{% endif %}
<div class="{{ rclass }} row-privacy">
    <div class="{{ class }}">
		<div class="form-check">
			<input type="hidden" id="consensi_{{ id }}_codice" name="__consensi__{{ nm }}[codice]" value="{{ codice }}">
			<input type="hidden" id="consensi_{{ id }}_reference" name="__consensi__{{ nm }}[reference]" value="{{ ref }}">
			<input type="hidden" id="consensi_{{ id }}_value" name="__consensi__{{ nm }}[value]" value="0">
			<input class="form-check-input" id="consensi_{{ id }}_checkbox" type="checkbox" {% if check.required %}required{% endif %}>
			<label class="form-check-label text-left" for="consensi_{{ id }}_checkbox">
			{{ tr.generic[ check.action ][ ietf ] }}
			{% if check.page %}<a href="{{ pages[ check.page ].url[ ietf ] }}" target="_blank">{% endif %}{{ check.label[ ietf ] | raw }}{% if check.page %}</a>{% endif %}
			({% if check.required %}{{ tr.generic.obbligatorio[ ietf ] | raw }}{% else %}{{ tr.generic.facoltativo[ ietf ] | raw }}{% endif %})
			</label>
		</div>
    </div>
</div>
{% else %}
<div class="{{ rclass }} row-privacy">
    <div class="{{ class }}">
		<p>nessun consenso richiesto per questo modulo</p>
    </div>
</div>
{% endfor %}
{% else %}
<!-- nessun consenso configurato per questo modulo -->
{% endif %}
{% endmacro %}
