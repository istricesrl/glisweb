{% macro mail( table, subtable, legend, site, page, pages, lang, etc, request, session ) %}
{% import '_bin/_form.html' as frm %}
{% set counter = 0 %}
<fieldset id="{{ subtable }}">
	{% set require = -1 %}{# normalmente è -1 ma si può settare a 0 per richiedere almeno 1 riga, 1 per 2, eccetera #}
    {{ frm.subformLegend( subtable, legend ) }}
    {% if request[ table ][ subtable ]|length and request[ table ][ subtable ] is iterable %}{% set t = request[ table ][ subtable ]|length - 1 %}
    {% else %}{% set t = require %}{% endif %}
	{% for i in -1..t %}
	{% set r = request[ table ][ subtable ][ request[ table ][ subtable ]|keys[ i ] ] %}
	{% if loop.first %}{% set disabled = 1 %}{% set dClasses = ' hidden show-on-duplicate' %}
	{% else %}{% set disabled = null %}{% set dClasses = null %}{% endif %}
    <div id="{{ subtable }}_{{ i }}" class="form-sub{{ dClasses }}">
	{{ frm.input( table, subtable, i, 'id', '', '', request, '', 'hidden', '', '', disabled ) }}
	{{ frm.input( table, subtable, i, 'id_anagrafica', '', '', '', '__parent_id__', 'hidden', '', '', disabled ) }}
	<div class="form-group form-row">
	    <div class="col">
		<span class="label-top">indirizzo</span>
		{{ frm.inputRequired( table, subtable, i, 'indirizzo', '', '', request, '', '', '', disabled ) }}
	    </div>
		<div class="col-auto">
		<span class="label-top">pec</span>
		{{ frm.select( table, subtable, i, 'se_pec', '', etc.select.se_pec, request, '', '', '', 1, '', disabled ) }}
		</div>
		<div class="w-100 d-block d-md-none m-0"></div>
	    <div class="col">
		<span class="label-top">note</span>
		{{ frm.input( table, subtable, i, 'note', '', '', request, '', '', '', '', disabled ) }}
	    </div>
		{% if r.id %}
		<div class="col-auto p-0 pl-1">
			<button type="button" class="btn btn-sm btn-secondary btn-sqr" onclick="window.open('{{ pages['mail.form'].url[ lang ] }}?mail[id]={{ r.id }}','_self')"><i class="fa fa-pencil"></i></button>
		</div>
	    <div class="col-auto text-right remove-on-duplicate d-print-none">
		{{ frm.trashButton( table, subtable, page, pages, r, lang, request ) }}
	    </div>
	    <div class="col-auto text-right show-on-duplicate d-print-none hidden">
		{{ frm.button( '<i class="fa fa-trash"></i>', 'button', 'btn-secondary btn-sqr show-on-duplicate hidden', '$( this ).closest( ".form-sub" ).remove();' ) }}
		</div>
		{% else %}
	    <div class="col-auto text-right d-print-none">
		{{ frm.button( '<i class="fa fa-minus"></i>', 'button', 'btn-secondary btn-sqr', '$( this ).closest( ".form-sub" ).remove();' ) }}
		</div>
		{% endif %}
	</div>
    </div>
    {% endfor %}
</fieldset>
{% endmacro %}

{% macro telefoni( table, subtable, legend, site, page, pages, lang, etc, request, session ) %}
{% import '_bin/_form.html' as frm %}
{% set counter = 0 %}
<fieldset id="{{ subtable }}">
	{% set require = -1 %}{# normalmente è -1 ma si può settare a 0 per richiedere almeno 1 riga, 1 per 2, eccetera #}
    {{ frm.subformLegend( subtable, legend ) }}
    {% if request[ table ][ subtable ]|length and request[ table ][ subtable ] is iterable %}{% set t = request[ table ][ subtable ]|length - 1 %}
    {% else %}{% set t = require %}{% endif %}
	{% for i in -1..t %}
	{% set r = request[ table ][ subtable ][ request[ table ][ subtable ]|keys[ i ] ] %}
	{% if loop.first %}{% set disabled = 1 %}{% set dClasses = ' hidden show-on-duplicate' %}
	{% else %}{% set disabled = null %}{% set dClasses = null %}{% endif %}
    <div id="{{ subtable }}_{{ i }}" class="form-sub{{ dClasses }}">
	{{ frm.input( table, subtable, i, 'id', '', '', request, '', 'hidden', '', '', disabled ) }}
	{{ frm.input( table, subtable, i, 'id_anagrafica', '', '', '', '__parent_id__', 'hidden', '', '', disabled ) }}
	<div class="form-group form-row">
	    <div class="col">
		<span class="label-top">numero</span>
		{{ frm.input( table, subtable, i, 'numero', '', '', request, '', '', '', '', disabled ) }}
	    </div>
	    <div class="col-auto">
		<span class="label-top">tipo</span>
		{{ frm.select( table, subtable, i, 'id_tipologia', '', etc.select.tipologie_telefoni, request, '', '', '', 1, '', disabled ) }}
		</div>
		<div class="w-100 d-block d-md-none m-0"></div>
	    <div class="col">
		<span class="label-top">note</span>
		{{ frm.input( table, subtable, i, 'note', '', '', request, '', '', '', '', disabled ) }}
	    </div>
	    {% if r.id %}
	    <div class="col-auto text-right remove-on-duplicate d-print-none">
		{{ frm.trashButton( table, subtable, page, pages, r, lang, request ) }}
	    </div>
	    <div class="col-auto text-right show-on-duplicate d-print-none hidden">
		{{ frm.button( '<i class="fa fa-trash"></i>', 'button', 'btn-secondary btn-sqr show-on-duplicate hidden', '$( this ).closest( ".form-sub" ).remove();' ) }}
		</div>
		{% else %}
	    <div class="col-auto text-right d-print-none">
		{{ frm.button( '<i class="fa fa-minus"></i>', 'button', 'btn-secondary btn-sqr', '$( this ).closest( ".form-sub" ).remove();' ) }}
		</div>
		{% endif %}
	</div>
    </div>
    {% endfor %}
</fieldset>
{% endmacro %}

{% macro indirizzi( table, subtable, legend, site, page, pages, lang, etc, request, session ) %}
{% import '_bin/_form.html' as frm %}
{% set counter = 0 %}
<fieldset id="{{ subtable }}">
	{% if request.__preset__.anagrafica_indirizzi %}
	{% set require = 0 %}
	{% else %}
	{% set require = -1 %}{# normalmente è -1 ma si può settare a 0 per richiedere almeno 1 riga, 1 per 2, eccetera #}
	{% endif %}
    {{ frm.subformLegend( subtable, legend ) }}
    {% if request[ table ][ subtable ]|length and request[ table ][ subtable ] is iterable %}{% set t = request[ table ][ subtable ]|length - 1 %}
    {% else %}{% set t = require %}{% endif %}
	{% for i in -1..t %}
	{% set r = request[ table ][ subtable ][ request[ table ][ subtable ]|keys[ i ] ] %}
	{% if loop.first %}{% set disabled = 1 %}{% set dClasses = ' hidden show-on-duplicate' %}
	{% else %}{% set disabled = null %}{% set dClasses = null %}{% endif %}
    <div id="{{ subtable }}_{{ i }}" class="form-sub{{ dClasses }}">
	{{ frm.input( table, subtable, i, 'id', '', '', request, '', 'hidden', '', '', disabled ) }}
	{{ frm.input( table, subtable, i, 'id_anagrafica', '', '', '', '__parent_id__', 'hidden', '', '', disabled ) }}
	<div class="form-group form-row">
		<div class="col-auto">
			<span class="label-top">ruolo</span>
			{{ frm.select( table, subtable, i, 'id_ruolo', '', etc.select.ruoli_indirizzi, request, '', '', '', 1, '', disabled ) }}
		</div>
	    <div class="col">
			<span class="label-top">indirizzo</span>
			{{ frm.selectBox( table, subtable, i, 'id_indirizzo', '', etc.select.indirizzi, request, '', '', '', '', '', 'indirizzi.form', '', 'indirizzi', 'id_indirizzo', page, pages, lang, 'indirizzi', disabled, '', 'modal-inserimento-indirizzi' ) }}
		</div>
		<div class="w-100 d-block d-md-none m-0"></div>
	    <div class="col-2 col-md-1">
			<span class="label-top">interno</span>
			{{ frm.input( table, subtable, i, 'interno', '', '', request, '', '', '', '', disabled ) }}
			</div>
			<div class="col">
			<span class="label-top">note</span>
		{{ frm.input( table, subtable, i, 'note', '', '', request, '', '', '', '', disabled ) }}
	    </div>
		{% if r.id %}
	    <div class="col-auto text-right remove-on-duplicate d-print-none">
		{{ frm.trashButton( table, subtable, page, pages, r, lang, request ) }}
	    </div>
	    <div class="col-auto text-right show-on-duplicate d-print-none hidden">
		{{ frm.button( '<i class="fa fa-trash"></i>', 'button', 'btn-secondary btn-sqr show-on-duplicate hidden', '$( this ).closest( ".form-sub" ).remove();' ) }}
		</div>
		{% else %}
	    <div class="col-auto text-right d-print-none">
		{{ frm.button( '<i class="fa fa-minus"></i>', 'button', 'btn-secondary btn-sqr', '$( this ).closest( ".form-sub" ).remove();' ) }}
		</div>
		{% endif %}
	</div>
    </div>
    {% endfor %}
</fieldset>
{% endmacro %}

{% macro indirizzi_rapidi( table, subtable, legend, site, page, pages, lang, etc, request, session ) %}
{% import '_bin/_form.html' as frm %}
{% set counter = 0 %}
<fieldset id="{{ subtable }}">
	{% set require = -1 %}{# normalmente è -1 ma si può settare a 0 per richiedere almeno 1 riga, 1 per 2, eccetera #}
    {{ frm.subformLegend( subtable, legend ) }}
    {% if request[ table ][ subtable ]|length and request[ table ][ subtable ] is iterable %}{% set t = request[ table ][ subtable ]|length - 1 %}
    {% else %}{% set t = require %}{% endif %}
	{% for i in -1..t %}
	{% set r = request[ table ][ subtable ][ request[ table ][ subtable ]|keys[ i ] ] %}
	{% if loop.first %}{% set disabled = 1 %}{% set dClasses = ' hidden show-on-duplicate' %}
	{% else %}{% set disabled = null %}{% set dClasses = null %}{% endif %}
    <div id="{{ subtable }}_{{ i }}" class="form-sub{{ dClasses }}">
	{{ frm.input( table, subtable, i, 'id', '', '', request, '', 'hidden', '', '', disabled ) }}
	{{ frm.input( table, subtable, i, 'id_anagrafica', '', '', '', '__parent_id__', 'hidden', '', '', disabled ) }}
	<div class="form-group form-row">
		<div class="col-auto">
			<span class="label-top">ruolo</span>
			{{ frm.select( table, subtable, i, 'id_ruolo', '', etc.select.ruoli_indirizzi, request, '', '', '', 1, '', disabled ) }}
		</div>
		<div class="col-8">
			<span class="label-top">indirizzo</span>
			{{ frm.input( table, subtable, i, 'indirizzo', '', '', request, '', '', '', '', disabled ) }}
		</div>
		<div class="col">
		<span class="label-top">note</span>
		{{ frm.input( table, subtable, i, 'note', '', '', request, '', '', '', '', disabled ) }}
	    </div>
		{% if r.id %}
	    <div class="col-auto text-right remove-on-duplicate d-print-none">
		{{ frm.trashButton( table, subtable, page, pages, r, lang, request ) }}
	    </div>
	    <div class="col-auto text-right show-on-duplicate d-print-none hidden">
		{{ frm.button( '<i class="fa fa-trash"></i>', 'button', 'btn-secondary btn-sqr show-on-duplicate hidden', '$( this ).closest( ".form-sub" ).remove();' ) }}
		</div>
		{% else %}
	    <div class="col-auto text-right d-print-none">
		{{ frm.button( '<i class="fa fa-minus"></i>', 'button', 'btn-secondary btn-sqr', '$( this ).closest( ".form-sub" ).remove();' ) }}
		</div>
		{% endif %}
	</div>
    </div>
    {% endfor %}
</fieldset>
{% endmacro %}

{% macro categorie( table, subtable, legend, site, page, pages, lang, etc, request, session ) %}
{% import '_bin/_form.html' as frm %}
{% set counter = 0 %}
<fieldset id="{{ subtable }}">
	{% set require = 0 %}{# normalmente è -1 ma si può settare a 0 per richiedere almeno 1 riga, 1 per 2, eccetera #}
    {{ frm.subformLegend( subtable, legend ) }}
    {% if request[ table ][ subtable ]|length and request[ table ][ subtable ] is iterable %}{% set t = request[ table ][ subtable ]|length - 1 %}
    {% else %}{% set t = require %}{% endif %}
	{% for i in -1..t %}
	{% set r = request[ table ][ subtable ][ request[ table ][ subtable ]|keys[ i ] ] %}
	{% if loop.first %}{% set disabled = 1 %}{% set dClasses = ' hidden show-on-duplicate' %}
	{% else %}{% set disabled = null %}{% set dClasses = null %}{% endif %}
	{% if session.account.id %}{% set account = session.account.id %}{% else %}{% set account = '__null__' %}{% endif %}
    {% if request[ table ][ subtable ][ i ].id %}{% set action = 'aggiornamento' %}
    {% else %}{% set action = 'inserimento' %}{% endif %}
    {% set timestamp = 'now'|date('U') %}
    <div id="{{ subtable }}_{{ i }}" class="form-sub{{ dClasses }}">
	{{ frm.input( table, subtable, i, 'id', '', '', request, '', 'hidden', '', '', disabled ) }}
	{{ frm.input( table, subtable, i, 'id_anagrafica', '', '', '', '__parent_id__', 'hidden', '', '', disabled ) }}
	{{ frm.input( table, subtable, i, 'id_account_' ~ action, '', '', '', account, 'hidden', '', '', disabled ) }}
	{{ frm.input( table, subtable, i, 'timestamp_' ~ action, '', '', '', timestamp, 'hidden', '', '', disabled ) }}
	<div class="form-group form-row">
	    <div class="col">
		<span class="label-top">categoria</span>
		{{ frm.selectRequired( table, subtable, i, 'id_categoria', '', etc.select.categorie_anagrafica, request, '1', 1, '', disabled ) }}
	    </div>
	    {% if r.id %}
	    <div class="col-auto text-right remove-on-duplicate d-print-none">
		{{ frm.trashButton( table, subtable, page, pages, r, lang, request ) }}
	    </div>
	    <div class="col-auto text-right show-on-duplicate d-print-none hidden">
		{{ frm.button( '<i class="fa fa-trash"></i>', 'button', 'btn-secondary btn-sqr show-on-duplicate hidden', '$( this ).closest( ".form-sub" ).remove();' ) }}
		</div>
		{% else %}
	    <div class="col-auto text-right d-print-none">
		{{ frm.button( '<i class="fa fa-minus"></i>', 'button', 'btn-secondary btn-sqr', '$( this ).closest( ".form-sub" ).remove();' ) }}
		</div>
		{% endif %}
	</div>
    </div>
    {% endfor %}
</fieldset>
{% endmacro %}

{% macro url( table, subtable, legend, site, page, pages, lang, etc, request, session ) %}
{% import '_bin/_form.html' as frm %}
{% set counter = 0 %}
<fieldset id="{{ subtable }}">
	{% set require = -1 %}{# normalmente è -1 ma si può settare a 0 per richiedere almeno 1 riga, 1 per 2, eccetera #}
    {{ frm.subformLegend( subtable, legend ) }}
    {% if request[ table ][ subtable ]|length and request[ table ][ subtable ] is iterable %}{% set t = request[ table ][ subtable ]|length - 1 %}
    {% else %}{% set t = require %}{% endif %}
	{% for i in -1..t %}
	{% set r = request[ table ][ subtable ][ request[ table ][ subtable ]|keys[ i ] ] %}
	{% if loop.first %}{% set disabled = 1 %}{% set dClasses = ' hidden show-on-duplicate' %}
	{% else %}{% set disabled = null %}{% set dClasses = null %}{% endif %}
    <div id="{{ subtable }}_{{ i }}" class="form-sub{{ dClasses }}">
	{{ frm.input( table, subtable, i, 'id', '', '', request, '', 'hidden', '', '', disabled ) }}
	{{ frm.input( table, subtable, i, 'id_anagrafica', '', '', '', '__parent_id__', 'hidden', '', '', disabled ) }}
	<div class="form-group form-row">
	    <div class="col">
		<span class="label-top">URL</span>
		{{ frm.input( table, subtable, i, 'url', '', '', request, '', '', '', '', disabled ) }}
	    </div>
	    <div class="col-auto">
		<span class="label-top">tipo</span>
		{{ frm.select( table, subtable, i, 'id_tipologia', '', etc.select.tipologie_url, request, '', '', '', 1, '', disabled ) }}
		</div>
		<div class="w-100 d-block d-md-none m-0"></div>
	    <div class="col">
		<span class="label-top">note</span>
		{{ frm.input( table, subtable, i, 'nome', '', '', request, '', '', '', '', disabled ) }}
	    </div>
	    {% if r.id %}
	    <div class="col-auto text-right remove-on-duplicate d-print-none">
		{{ frm.trashButton( table, subtable, page, pages, r, lang, request ) }}
	    </div>
	    <div class="col-auto text-right show-on-duplicate d-print-none hidden">
		{{ frm.button( '<i class="fa fa-trash"></i>', 'button', 'btn-secondary btn-sqr show-on-duplicate hidden', '$( this ).closest( ".form-sub" ).remove();' ) }}
		</div>
		{% else %}
	    <div class="col-auto text-right d-print-none">
		{{ frm.button( '<i class="fa fa-minus"></i>', 'button', 'btn-secondary btn-sqr', '$( this ).closest( ".form-sub" ).remove();' ) }}
		</div>
		{% endif %}
	</div>
    </div>
    {% endfor %}
</fieldset>
{% endmacro %}
